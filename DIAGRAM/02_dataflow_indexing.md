# Data Flow: Proses Indexing PDF

## Overview
Dokumen ini menjelaskan aliran data lengkap saat user melakukan indexing PDF ke dalam vector database.

## High-Level Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User   â”‚â”€â”€â”€â”€â”€â–¶â”‚   MCP    â”‚â”€â”€â”€â”€â”€â–¶â”‚    PDF    â”‚â”€â”€â”€â”€â”€â–¶â”‚ Embeddingâ”‚â”€â”€â”€â”€â”€â–¶â”‚  Vector  â”‚
â”‚ Claude  â”‚      â”‚  Server  â”‚      â”‚ Processor â”‚      â”‚Generator â”‚      â”‚  Store   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                                â”‚
                                                                                â–¼
                                                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                         â”‚ ChromaDB â”‚
                                                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Detailed Step-by-Step Flow

### Step 1: User Input via Claude Desktop

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Claude Desktop                    â”‚
â”‚                                            â”‚
â”‚  User ketik:                               â”‚
â”‚  "Index file report_2024.pdf"             â”‚
â”‚                                            â”‚
â”‚  MCP Client mengirim request:              â”‚
â”‚  {                                         â”‚
â”‚    "tool": "index_pdf",                    â”‚
â”‚    "params": {                             â”‚
â”‚      "file_path": "pdfs/report_2024.pdf"  â”‚
â”‚    }                                       â”‚
â”‚  }                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ STDIO Communication
              â”‚ (JSON-RPC over stdin/stdout)
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        MCP Server (mcp_server.py)          â”‚
â”‚                                            â”‚
â”‚  @mcp.tool()                               â”‚
â”‚  async def index_pdf(file_path: str):      â”‚
â”‚      # Receive request                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 2: Path Resolution & Validation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              MCP Server: index_pdf()                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  Input: "pdfs/report_2024.pdf"                            â”‚
â”‚                                                            â”‚
â”‚  1. Resolve relative path:                                â”‚
â”‚     config.pdf_directory / file_path                      â”‚
â”‚     = C:/Users/arif/.../pdf-vectordb-mcp/pdfs/report...   â”‚
â”‚                                                            â”‚
â”‚  2. Validate file exists:                                 â”‚
â”‚     pdf_path.exists() âœ“                                   â”‚
â”‚                                                            â”‚
â”‚  3. Check if PDF:                                         â”‚
â”‚     pdf_path.suffix == '.pdf' âœ“                           â”‚
â”‚                                                            â”‚
â”‚  4. Compute file hash:                                    â”‚
â”‚     file_hash = compute_file_hash(pdf_path)               â”‚
â”‚     = "a3f5e9d8c7b2..."                                   â”‚
â”‚                                                            â”‚
â”‚  5. Check if already indexed:                             â”‚
â”‚     existing_docs = vector_store.list_documents()         â”‚
â”‚     if file already indexed with same hash:               â”‚
â”‚        return "Already indexed, skipping"                 â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ Valid PDF file
              â–¼
```

### Step 3: PDF Text Extraction

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PDFProcessor: process_pdf()                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  Input: Path("pdfs/report_2024.pdf")                      â”‚
â”‚                                                            â”‚
â”‚  3.1 Open PDF with PyPDF2                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  reader = PdfReader(pdf_path)                    â”‚    â”‚
â”‚  â”‚  num_pages = len(reader.pages)                   â”‚    â”‚
â”‚  â”‚  # Output: 15 pages                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                            â”‚
â”‚  3.2 Extract text per page                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  for page_num, page in enumerate(reader.pages):  â”‚    â”‚
â”‚  â”‚      text = page.extract_text()                  â”‚    â”‚
â”‚  â”‚      full_text += text                           â”‚    â”‚
â”‚  â”‚                                                   â”‚    â”‚
â”‚  â”‚  Output:                                          â”‚    â”‚
â”‚  â”‚  Page 0: "Executive Summary\nThis report..."     â”‚    â”‚
â”‚  â”‚  Page 1: "Introduction\nOur analysis shows..."   â”‚    â”‚
â”‚  â”‚  ...                                              â”‚    â”‚
â”‚  â”‚  Page 14: "Conclusion\nIn summary..."            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                            â”‚
â”‚  Result:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  full_text = """                                 â”‚    â”‚
â”‚  â”‚  Executive Summary                               â”‚    â”‚
â”‚  â”‚  This report presents findings from...           â”‚    â”‚
â”‚  â”‚  [~25,000 characters total]                      â”‚    â”‚
â”‚  â”‚  """                                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ Extracted text
              â–¼
```

### Step 4: Text Chunking

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Utils: chunk_text()                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  Input:                                                    â”‚
â”‚  â€¢ text = "Executive Summary\nThis report..." (25k chars) â”‚
â”‚  â€¢ chunk_size = 1000 characters                           â”‚
â”‚  â€¢ chunk_overlap = 200 characters                         â”‚
â”‚                                                            â”‚
â”‚  Algorithm:                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  start = 0                                        â”‚    â”‚
â”‚  â”‚  while start < len(text):                        â”‚    â”‚
â”‚  â”‚      end = start + chunk_size                    â”‚    â”‚
â”‚  â”‚      chunk = text[start:end]                     â”‚    â”‚
â”‚  â”‚      chunks.append(chunk)                        â”‚    â”‚
â”‚  â”‚      start += (chunk_size - chunk_overlap)       â”‚    â”‚
â”‚  â”‚      # Move 800 chars, overlap 200 chars         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                            â”‚
â”‚  Output: List of 32 chunks                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Chunk 0: "Executive Summary\nThis report        â”‚    â”‚
â”‚  â”‚            presents findings from..." [1000 chars]â”‚    â”‚
â”‚  â”‚                                                   â”‚    â”‚
â”‚  â”‚  Chunk 1: "...findings from our comprehensive    â”‚    â”‚
â”‚  â”‚            analysis of..." [1000 chars]          â”‚    â”‚
â”‚  â”‚            â†‘ Overlap 200 chars dengan chunk 0    â”‚    â”‚
â”‚  â”‚                                                   â”‚    â”‚
â”‚  â”‚  Chunk 2: "...analysis of market trends and..."  â”‚    â”‚
â”‚  â”‚                                                   â”‚    â”‚
â”‚  â”‚  ...                                              â”‚    â”‚
â”‚  â”‚                                                   â”‚    â”‚
â”‚  â”‚  Chunk 31: "...In summary, we recommend..."      â”‚    â”‚
â”‚  â”‚             [750 chars - last chunk]             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                            â”‚
â”‚  Why overlap?                                              â”‚
â”‚  â€¢ Preserve context across chunk boundaries               â”‚
â”‚  â€¢ Improve semantic continuity                            â”‚
â”‚  â€¢ Better retrieval quality                               â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ List of 32 text chunks
              â–¼
```

### Step 5: Generate Embeddings

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      EmbeddingGenerator: generate_batch()                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  Input: 32 text chunks                                     â”‚
â”‚                                                            â”‚
â”‚  5.1 Load Model (first time only)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  if self.model is None:                          â”‚    â”‚
â”‚  â”‚      self.model = SentenceTransformer(           â”‚    â”‚
â”‚  â”‚          'all-mpnet-base-v2',                    â”‚    â”‚
â”‚  â”‚          device='cpu'                            â”‚    â”‚
â”‚  â”‚      )                                            â”‚    â”‚
â”‚  â”‚  # Model loaded: 420MB in memory                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                            â”‚
â”‚  5.2 Encode chunks â†’ vectors                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  embeddings = self.model.encode(                 â”‚    â”‚
â”‚  â”‚      chunks,                                     â”‚    â”‚
â”‚  â”‚      batch_size=32,                              â”‚    â”‚
â”‚  â”‚      show_progress_bar=True                      â”‚    â”‚
â”‚  â”‚  )                                                â”‚    â”‚
â”‚  â”‚                                                   â”‚    â”‚
â”‚  â”‚  # Processing...                                 â”‚    â”‚
â”‚  â”‚  Batches: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 1/1 [00:02<00:00]   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                            â”‚
â”‚  Output: Numpy array of embeddings                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  embeddings.shape = (32, 768)                    â”‚    â”‚
â”‚  â”‚                                                   â”‚    â”‚
â”‚  â”‚  embeddings[0] = [0.0234, -0.0891, 0.1234, ...] â”‚    â”‚
â”‚  â”‚                  [768 dimensions]                â”‚    â”‚
â”‚  â”‚                                                   â”‚    â”‚
â”‚  â”‚  embeddings[1] = [-0.0456, 0.0678, -0.0123, ...]â”‚    â”‚
â”‚  â”‚                                                   â”‚    â”‚
â”‚  â”‚  ...                                              â”‚    â”‚
â”‚  â”‚                                                   â”‚    â”‚
â”‚  â”‚  embeddings[31] = [0.0789, -0.0345, 0.0567, ...]â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                            â”‚
â”‚  Conversion to list:                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  return embeddings.tolist()                      â”‚    â”‚
â”‚  â”‚  # ChromaDB requires Python list, not numpy     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ 32 embeddings (768-dim vectors)
              â–¼
```

### Step 6: Prepare Documents for Storage

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         MCP Server: Prepare documents                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  Combine: chunks + embeddings + metadata                   â”‚
â”‚                                                            â”‚
â”‚  For each chunk (i = 0 to 31):                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  document = {                                     â”‚    â”‚
â”‚  â”‚      "id": generate_chunk_id(                    â”‚    â”‚
â”‚  â”‚              pdf_path,                           â”‚    â”‚
â”‚  â”‚              chunk_index=i                       â”‚    â”‚
â”‚  â”‚          ),                                       â”‚    â”‚
â”‚  â”‚      # "report_2024_chunk_0"                     â”‚    â”‚
â”‚  â”‚                                                   â”‚    â”‚
â”‚  â”‚      "text": chunks[i],                          â”‚    â”‚
â”‚  â”‚      # "Executive Summary\nThis report..."       â”‚    â”‚
â”‚  â”‚                                                   â”‚    â”‚
â”‚  â”‚      "embedding": embeddings[i],                 â”‚    â”‚
â”‚  â”‚      # [0.0234, -0.0891, ...]                    â”‚    â”‚
â”‚  â”‚                                                   â”‚    â”‚
â”‚  â”‚      "metadata": {                                â”‚    â”‚
â”‚  â”‚          "file_path": "pdfs/report_2024.pdf",   â”‚    â”‚
â”‚  â”‚          "file_name": "report_2024.pdf",         â”‚    â”‚
â”‚  â”‚          "file_hash": "a3f5e9d8c7b2...",         â”‚    â”‚
â”‚  â”‚          "chunk_index": i,                       â”‚    â”‚
â”‚  â”‚          "total_chunks": 32,                     â”‚    â”‚
â”‚  â”‚          "indexed_at": "2024-01-15T10:30:00Z"   â”‚    â”‚
â”‚  â”‚      }                                            â”‚    â”‚
â”‚  â”‚  }                                                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                            â”‚
â”‚  Result: List of 32 documents ready for storage           â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ 32 prepared documents
              â–¼
```

### Step 7: Store in Vector Database

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         VectorStore: add_documents()                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  Input: 32 documents with embeddings                       â”‚
â”‚                                                            â”‚
â”‚  7.1 Extract components                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ids = [doc["id"] for doc in documents]          â”‚    â”‚
â”‚  â”‚  # ["report_2024_chunk_0", ..., "..._chunk_31"] â”‚    â”‚
â”‚  â”‚                                                   â”‚    â”‚
â”‚  â”‚  texts = [doc["text"] for doc in documents]      â”‚    â”‚
â”‚  â”‚  # [chunk0_text, chunk1_text, ...]              â”‚    â”‚
â”‚  â”‚                                                   â”‚    â”‚
â”‚  â”‚  embeddings = [doc["embedding"] for doc in docs] â”‚    â”‚
â”‚  â”‚  # [[0.0234, ...], [-0.0456, ...], ...]         â”‚    â”‚
â”‚  â”‚                                                   â”‚    â”‚
â”‚  â”‚  metadatas = [doc["metadata"] for doc in docs]   â”‚    â”‚
â”‚  â”‚  # [{file_path: ..., chunk_index: 0}, {...}]    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                            â”‚
â”‚  7.2 Add to ChromaDB collection                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  self.collection.add(                            â”‚    â”‚
â”‚  â”‚      ids=ids,                                    â”‚    â”‚
â”‚  â”‚      documents=texts,                            â”‚    â”‚
â”‚  â”‚      embeddings=embeddings,                      â”‚    â”‚
â”‚  â”‚      metadatas=metadatas                         â”‚    â”‚
â”‚  â”‚  )                                                â”‚    â”‚
â”‚  â”‚                                                   â”‚    â”‚
â”‚  â”‚  # ChromaDB internally:                          â”‚    â”‚
â”‚  â”‚  # 1. Store documents in SQLite                 â”‚    â”‚
â”‚  â”‚  # 2. Build HNSW index for embeddings           â”‚    â”‚
â”‚  â”‚  # 3. Persist to disk                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ Success
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ChromaDB Storage                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  File: ./chroma_db/chroma.sqlite3                         â”‚
â”‚                                                            â”‚
â”‚  Collection: pdf_documents                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Total documents: 32                             â”‚    â”‚
â”‚  â”‚                                                   â”‚    â”‚
â”‚  â”‚  Document 0:                                      â”‚    â”‚
â”‚  â”‚    ID: "report_2024_chunk_0"                     â”‚    â”‚
â”‚  â”‚    Text: "Executive Summary..."                  â”‚    â”‚
â”‚  â”‚    Embedding: [0.0234, -0.0891, ...] (768-dim)  â”‚    â”‚
â”‚  â”‚    Metadata: {file_path: "...", chunk_index: 0} â”‚    â”‚
â”‚  â”‚                                                   â”‚    â”‚
â”‚  â”‚  Document 1:                                      â”‚    â”‚
â”‚  â”‚    ID: "report_2024_chunk_1"                     â”‚    â”‚
â”‚  â”‚    ...                                            â”‚    â”‚
â”‚  â”‚                                                   â”‚    â”‚
â”‚  â”‚  ...                                              â”‚    â”‚
â”‚  â”‚                                                   â”‚    â”‚
â”‚  â”‚  Document 31:                                     â”‚    â”‚
â”‚  â”‚    ID: "report_2024_chunk_31"                    â”‚    â”‚
â”‚  â”‚    ...                                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                            â”‚
â”‚  HNSW Index built for fast similarity search             â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 8: Return Result to User

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         MCP Server: Return response                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  Prepare success response:                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  result = {                                       â”‚    â”‚
â”‚  â”‚      "status": "success",                        â”‚    â”‚
â”‚  â”‚      "file_path": "pdfs/report_2024.pdf",       â”‚    â”‚
â”‚  â”‚      "num_pages": 15,                            â”‚    â”‚
â”‚  â”‚      "num_chunks": 32,                           â”‚    â”‚
â”‚  â”‚      "file_hash": "a3f5e9d8c7b2...",            â”‚    â”‚
â”‚  â”‚      "message": "Successfully indexed PDF"       â”‚    â”‚
â”‚  â”‚  }                                                â”‚    â”‚
â”‚  â”‚                                                   â”‚    â”‚
â”‚  â”‚  return result                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ MCP Protocol (JSON-RPC)
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Claude Desktop                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  Displays to user:                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  âœ… Successfully indexed PDF                      â”‚    â”‚
â”‚  â”‚                                                   â”‚    â”‚
â”‚  â”‚  File: report_2024.pdf                           â”‚    â”‚
â”‚  â”‚  Pages: 15                                        â”‚    â”‚
â”‚  â”‚  Chunks created: 32                               â”‚    â”‚
â”‚  â”‚                                                   â”‚    â”‚
â”‚  â”‚  Your document is now searchable!                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Timeline & Performance

```
Step 1: User Input                     âš¡ < 1ms
   â†“
Step 2: Validation                     âš¡ ~10ms
   â†“
Step 3: PDF Extraction                 ğŸ“„ ~500ms (15 pages)
   â†“
Step 4: Chunking                       âš¡ ~50ms
   â†“
Step 5: Generate Embeddings            ğŸ”¥ ~2000ms (32 chunks, CPU)
   â†“                                      âš¡ ~500ms (with GPU)
Step 6: Prepare Documents              âš¡ ~20ms
   â†“
Step 7: Store in VectorDB              ğŸ’¾ ~300ms
   â†“
Step 8: Return Result                  âš¡ < 1ms
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Total: ~3 seconds (CPU) / ~1.5 seconds (GPU)
```

## Error Handling

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Possible Errors & Handling                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  1. File not found                          â”‚
â”‚     â†’ Return error: "File does not exist"   â”‚
â”‚                                             â”‚
â”‚  2. Not a PDF file                          â”‚
â”‚     â†’ Return error: "Not a valid PDF"       â”‚
â”‚                                             â”‚
â”‚  3. PDF extraction failed                   â”‚
â”‚     â†’ Return error: "Failed to extract text"â”‚
â”‚                                             â”‚
â”‚  4. Empty PDF (no text)                     â”‚
â”‚     â†’ Return warning: "No text extracted"   â”‚
â”‚                                             â”‚
â”‚  5. Embedding generation failed             â”‚
â”‚     â†’ Return error: "Failed to generate     â”‚
â”‚        embeddings"                          â”‚
â”‚                                             â”‚
â”‚  6. ChromaDB storage failed                 â”‚
â”‚     â†’ Return error: "Failed to store in DB" â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Size Examples

### Example: 10-page PDF
```
Input PDF: 10 pages
   â†“
Extracted Text: ~15,000 characters
   â†“
Chunks: ~19 chunks (1000 chars each, 200 overlap)
   â†“
Embeddings: 19 x 768 = 14,592 floats
   â†“
Storage: ~58 KB (embeddings) + ~15 KB (text) = ~73 KB total
```

### Example: 100-page PDF
```
Input PDF: 100 pages
   â†“
Extracted Text: ~150,000 characters
   â†“
Chunks: ~188 chunks
   â†“
Embeddings: 188 x 768 = 144,384 floats
   â†“
Storage: ~577 KB (embeddings) + ~150 KB (text) = ~727 KB total
```

## Summary

Proses indexing melibatkan 8 langkah utama:
1. **Receive** - Terima request dari user
2. **Validate** - Validasi file path & check duplicates
3. **Extract** - Extract text dari PDF dengan PyPDF2
4. **Chunk** - Split text menjadi chunks dengan overlap
5. **Embed** - Generate vector embeddings dengan SentenceTransformer
6. **Prepare** - Combine chunks, embeddings, dan metadata
7. **Store** - Simpan ke ChromaDB dengan HNSW indexing
8. **Return** - Return hasil ke user

Total waktu: **~3 detik** untuk PDF 15 halaman (dengan CPU)

